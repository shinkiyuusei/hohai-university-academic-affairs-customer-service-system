import{_ as T}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                  *//* empty css                   *//* empty css               *//* empty css                *//* empty css                     *//* empty css                 *//* empty css                *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                  *//* empty css                  */import{d as H,u as Q,q as W,r as f,l as X,f as s,g as a,w as l,an as Y,ac as ee,o as ae,ao as se,ab as le,$ as oe,ap as te,k as re,m as v,A as ne,B as V,aq as de,z as _,y as ie,aj as ue,E as pe,h as me,i as fe,ar as ve,as as ce,n as w,at as A}from"./index-DEMRRUfB.js";import{f as J}from"./file_request-DuOzIPHm.js";const ge={class:"profile"},_e={class:"card-header"},we={class:"profile-info"},be={class:"avatar-wrapper"},ye={class:"info-list"},Pe={class:"info-item"},he={class:"value"},Ve={class:"info-item"},Ie={class:"value"},Ne={class:"info-item"},Ee={class:"value"},Ue={class:"info-item"},ke={class:"value"},Se={class:"info-item"},xe={class:"info-item"},Ce={class:"card-header"},qe={class:"dialog-footer"},ze=H({__name:"Profile",setup(Be){const P=Q(),t=W(()=>P.userInfo),u=f({oldPassword:"",newPassword:"",confirmPassword:""}),O={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"},{min:6,max:20,message:"密码长度应在6-20个字符之间",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度应在6-20个字符之间",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(r,e,o)=>{e===""?o(new Error("请再次输入密码")):e!==u.value.newPassword?o(new Error("两次输入密码不一致!")):o()},trigger:"blur"}]},I=f(!1),N=f(),j=async()=>{var r;if(N.value)try{await N.value.validate(),I.value=!0,await P.changePassword({id:(r=t.value)==null?void 0:r.id,oldPassword:u.value.oldPassword,newPassword:u.value.newPassword}),w.success("密码修改成功"),u.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(e){console.error("修改密码失败:",e)}finally{I.value=!1}},i=f({realName:"",phone:"",email:""}),G={realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"},{min:2,max:20,message:"真实姓名长度应在2-20个字符之间",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"请输入正确的邮箱地址",trigger:"blur"}]},b=f(!1),E=f(!1),U=f(),$=()=>{var r,e,o;i.value={realName:((r=t.value)==null?void 0:r.realName)||"",phone:((e=t.value)==null?void 0:e.phone)||"",email:((o=t.value)==null?void 0:o.email)||""},b.value=!0},D=async()=>{var r,e,o;if(U.value)try{await U.value.validate(),E.value=!0,await A({id:(r=t.value)==null?void 0:r.id,realName:i.value.realName,phone:i.value.phone,email:i.value.email,role:(e=t.value)==null?void 0:e.role,status:(o=t.value)==null?void 0:o.status});const d=localStorage.getItem("userInfo");if(d){const p=JSON.parse(d);p.userInfo={...p.userInfo,realName:i.value.realName,phone:i.value.phone,email:i.value.email},localStorage.setItem("userInfo",JSON.stringify(p)),P.initUserInfo()}w.success("个人信息修改成功"),b.value=!1}catch(d){console.error("修改个人信息失败:",d)}finally{E.value=!1}},K=r=>{const e=r.type==="image/jpeg",o=r.type==="image/png",d=r.size/1024/1024<2;return!e&&!o?(w.error("头像只能是 JPG 或 PNG 格式!"),!1):d?!0:(w.error("头像大小不能超过 2MB!"),!1)},L=async r=>{var e;if(r.raw)try{const{bucket:o,objectKey:d}=await J.upload("avatars",r.raw),p={id:(e=t.value)==null?void 0:e.id,avatarBucket:o,avatarObjectKey:d};await A(p);const h=localStorage.getItem("userInfo");if(h){const c=JSON.parse(h);c.userInfo={...c.userInfo,avatarBucket:o,avatarObjectKey:d,avatarUrl:J.getFileUrl(o,d)},localStorage.setItem("userInfo",JSON.stringify(c)),P.initUserInfo()}w.success("头像更新成功")}catch(o){console.error("头像上传失败:",o),w.error("头像上传失败")}};return(r,e)=>{const o=ne,d=re,p=oe,h=te,c=ie,k=le,S=se,g=fe,m=me,x=pe,M=Y,Z=ee;return ae(),X("div",ge,[e[21]||(e[21]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"个人中心"),s("p",{class:"page-description"},"管理您的个人信息和账户设置")],-1)),a(M,{gutter:24},{default:l(()=>[a(S,{span:12},{default:l(()=>[a(k,{class:"profile-card",shadow:"never"},{header:l(()=>[s("div",_e,[e[9]||(e[9]=s("div",{class:"header-info"},[s("span",{class:"header-title"},"个人信息"),s("span",{class:"header-subtitle"},"查看和编辑您的基本信息")],-1)),a(d,{type:"primary",plain:"",onClick:$,class:"edit-btn"},{default:l(()=>[a(o,null,{default:l(()=>[a(V(ue))]),_:1}),e[8]||(e[8]=v(" 编辑资料 ",-1))]),_:1})])]),default:l(()=>{var n,C,q,z,B,F,R;return[s("div",we,[s("div",be,[a(p,{size:100,src:(n=t.value)==null?void 0:n.avatarUrl},null,8,["src"]),a(h,{class:"avatar-uploader","auto-upload":!1,"show-file-list":!1,"on-change":L,"before-upload":K},{default:l(()=>[a(d,{type:"primary",link:"",class:"change-avatar"},{default:l(()=>[a(o,null,{default:l(()=>[a(V(de))]),_:1}),e[10]||(e[10]=v(" 更换头像 ",-1))]),_:1})]),_:1})]),s("div",ye,[s("div",Pe,[e[11]||(e[11]=s("span",{class:"label"},"用户名：",-1)),s("span",he,_((C=t.value)==null?void 0:C.username),1)]),s("div",Ve,[e[12]||(e[12]=s("span",{class:"label"},"真实姓名：",-1)),s("span",Ie,_((q=t.value)==null?void 0:q.realName),1)]),s("div",Ne,[e[13]||(e[13]=s("span",{class:"label"},"手机号：",-1)),s("span",Ee,_((z=t.value)==null?void 0:z.phone),1)]),s("div",Ue,[e[14]||(e[14]=s("span",{class:"label"},"邮箱：",-1)),s("span",ke,_((B=t.value)==null?void 0:B.email),1)]),s("div",Se,[e[15]||(e[15]=s("span",{class:"label"},"角色：",-1)),a(c,{type:((F=t.value)==null?void 0:F.role)===1?"danger":"info",size:"small"},{default:l(()=>{var y;return[v(_(((y=t.value)==null?void 0:y.role)===1?"管理员":"普通用户"),1)]}),_:1},8,["type"])]),s("div",xe,[e[16]||(e[16]=s("span",{class:"label"},"状态：",-1)),a(c,{type:((R=t.value)==null?void 0:R.status)===1?"success":"danger",size:"small"},{default:l(()=>{var y;return[v(_(((y=t.value)==null?void 0:y.status)===1?"正常":"禁用"),1)]}),_:1},8,["type"])])])])]}),_:1})]),_:1}),a(S,{span:12},{default:l(()=>[a(k,{class:"password-card",shadow:"never"},{header:l(()=>[s("div",Ce,[e[17]||(e[17]=s("div",{class:"header-info"},[s("span",{class:"header-title"},"安全设置"),s("span",{class:"header-subtitle"},"修改您的登录密码")],-1)),a(o,{class:"header-icon"},{default:l(()=>[a(V(ce))]),_:1})])]),default:l(()=>[a(x,{ref_key:"passwordFormRef",ref:N,model:u.value,rules:O,"label-width":"100px","status-icon":""},{default:l(()=>[a(m,{label:"原密码",prop:"oldPassword"},{default:l(()=>[a(g,{modelValue:u.value.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value.oldPassword=n),type:"password","show-password":"",placeholder:"请输入原密码"},null,8,["modelValue"])]),_:1}),a(m,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(g,{modelValue:u.value.newPassword,"onUpdate:modelValue":e[1]||(e[1]=n=>u.value.newPassword=n),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(m,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(g,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>u.value.confirmPassword=n),type:"password","show-password":"",placeholder:"请确认新密码"},null,8,["modelValue"])]),_:1}),a(m,null,{default:l(()=>[a(d,{type:"primary",loading:I.value,onClick:j},{default:l(()=>[a(o,null,{default:l(()=>[a(V(ve))]),_:1}),e[18]||(e[18]=v(" 修改密码 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),a(Z,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=n=>b.value=n),title:"编辑个人信息",width:"500px","destroy-on-close":""},{footer:l(()=>[s("span",qe,[a(d,{onClick:e[6]||(e[6]=n=>b.value=!1)},{default:l(()=>[...e[19]||(e[19]=[v("取消",-1)])]),_:1}),a(d,{type:"primary",loading:E.value,onClick:D},{default:l(()=>[...e[20]||(e[20]=[v(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(x,{ref_key:"editFormRef",ref:U,model:i.value,rules:G,"label-width":"100px","status-icon":""},{default:l(()=>[a(m,{label:"真实姓名",prop:"realName"},{default:l(()=>[a(g,{modelValue:i.value.realName,"onUpdate:modelValue":e[3]||(e[3]=n=>i.value.realName=n),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),a(m,{label:"手机号",prop:"phone"},{default:l(()=>[a(g,{modelValue:i.value.phone,"onUpdate:modelValue":e[4]||(e[4]=n=>i.value.phone=n),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(m,{label:"邮箱",prop:"email"},{default:l(()=>[a(g,{modelValue:i.value.email,"onUpdate:modelValue":e[5]||(e[5]=n=>i.value.email=n),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),We=T(ze,[["__scopeId","data-v-17b22459"]]);export{We as default};
