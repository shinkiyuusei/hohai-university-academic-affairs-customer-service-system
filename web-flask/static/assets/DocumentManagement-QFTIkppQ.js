import{_ as be}from"./_plugin-vue_export-helper-DRcqrMy4.js";/* empty css                   *//* empty css                 *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                  *//* empty css                    *//* empty css                     *//* empty css                      *//* empty css               *//* empty css                        *//* empty css                   *//* empty css                 *//* empty css                  */import{p as b,d as Ce,r as p,aI as Q,s as Ve,l as W,f as n,g as t,m as d,w as a,A as Be,k as Te,j as ze,i as De,I as Ue,av as Ee,c as C,aC as Me,aD as Fe,ac as Le,n as u,o as y,B as c,P as F,aJ as Se,aK as Re,z as g,aB as Ge,y as $e,ar as Ie,aL as Ne,aM as je,aj as X,ae as Ke,E as Oe,h as Pe,ap as qe,aN as Ae,x as He,aO as Je,aP as Qe,aQ as We,ai as Xe}from"./index-CRHGP1uJ.js";import{f as Ye}from"./file_request-JDQRTYRG.js";import{d as Ze}from"./marked.esm-CbTws8Ir.js";const V={upload:v=>b.post("/document/upload",v,{headers:{"Content-Type":"multipart/form-data"}}),getList:v=>b.get("/document/list",{params:v}),getDetail:v=>b.get(`/document/detail/${v}`),delete:v=>b.delete(`/document/delete/${v}`),update:(v,B)=>b.put(`/document/update/${v}`,B),generateSummary:v=>b.post("/document/generate-summary",{content:v})},et={class:"document-management"},tt={class:"page-header"},lt={class:"page-title"},at={class:"action-bar"},ot={class:"left-actions"},nt={class:"right-actions"},st={class:"document-list"},it={class:"document-title"},rt={class:"pagination-wrapper"},ut={class:"dialog-footer"},dt={key:0,class:"document-detail"},pt={class:"detail-header"},mt={class:"detail-meta"},ct={class:"detail-content"},ft={class:"content-section"},vt={class:"summary-text"},gt={class:"content-section"},_t={class:"content-text markdown-content"},yt=["innerHTML"],wt={class:"detail-actions"},ht={class:"form-item-container"},xt={class:"dialog-footer"},kt=Ce({__name:"DocumentManagement",setup(v){const B=p(!1),K=p([]),h=p(1),U=p(10),O=p(0),L=p(""),E=p([]),T=p(!1),M=p(!1),x=p(!1),S=p(!1),R=p(!1),G=p(!1),f=Q({title:"",file:null}),s=Q({id:0,title:"",summary:"",content:"",isGraphBuilt:0}),m=p(null),Y={title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],file:[{required:!0,message:"请选择文件",trigger:"change"}]},Z={title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],summary:[{max:500,message:"文档摘要不能超过500个字符",trigger:"blur"}],content:[{max:1e4,message:"文档内容不能超过10000个字符",trigger:"blur"}]},$=p(),P=p(),z=p(),w=async()=>{try{B.value=!0;const l={page:h.value,size:U.value,keyword:L.value||void 0},e=await V.getList(l);K.value=e.records,O.value=e.total}catch{u.error("获取文档列表失败")}finally{B.value=!1}},q=()=>{h.value=1,w()},ee=l=>{U.value=l,h.value=1,w()},te=l=>{h.value=l,w()},le=(l,e)=>{if(E.value=[l],f.file=l.raw,l.name){const r=l.name,i=r.lastIndexOf(".");i>0?f.title=r.substring(0,i):f.title=r}},ae=()=>{E.value=[],f.file=null,f.title=""},oe=l=>{z.value.clearFiles();const e=l[l.length-1];z.value.handleStart(e),z.value.handleSuccess(e)},ne=l=>[".txt",".docx",".doc",".pdf"].some(i=>l.name.toLowerCase().endsWith(i))?(l.size/1024/1024<50||u.error("文件大小不能超过 50MB"),!1):(u.error("只支持 txt、docx、doc、pdf 格式的文件"),!1),se=async()=>{if(!f.file){u.error("请选择文件");return}try{await $.value.validate(),S.value=!0;const l=new FormData;l.append("title",f.title),l.append("file",f.file),await V.upload(l),u.success("文档上传成功"),T.value=!1,ie(),w()}catch{u.error("文档上传失败")}finally{S.value=!1}},ie=()=>{var l,e;f.title="",f.file=null,E.value=[],(l=$.value)==null||l.resetFields(),(e=z.value)==null||e.clearFiles()},re=async l=>{try{const e=await V.getDetail(l.id);m.value=e,M.value=!0}catch{u.error("获取文档详情失败")}},ue=l=>{s.id=l.id,s.title=l.title,s.summary=l.summary,s.content=l.content,s.isGraphBuilt=l.isGraphBuilt,x.value=!0},de=()=>{m.value&&(s.id=m.value.id,s.title=m.value.title,s.summary=m.value.summary,s.content=m.value.content,s.isGraphBuilt=m.value.isGraphBuilt,M.value=!1,x.value=!0)},pe=async()=>{try{await P.value.validate(),R.value=!0,await V.update(s.id,{title:s.title,summary:s.summary,content:s.content,isGraphBuilt:s.isGraphBuilt}),u.success("文档更新成功"),x.value=!1,w()}catch{u.error("文档更新失败")}finally{R.value=!1}},me=async()=>{try{if(!s.content||s.content.trim().length===0){u.warning("请先输入文档内容");return}if(s.content.length>1e4){u.warning("文档内容不能超过10000字，请精简内容后重试");return}G.value=!0;const l=await V.generateSummary(s.content);u.success("摘要生成成功"),s.summary=l.summary}catch{u.error("摘要生成失败")}finally{G.value=!1}},ce=async l=>{try{if(!l.fileBucket||!l.fileObjectKey){u.error("文档文件信息缺失，无法下载");return}u.info("正在准备下载...");const e=await Ye.get(l.fileBucket,l.fileObjectKey),r=window.URL.createObjectURL(e),i=document.createElement("a");i.href=r,i.download=l.filename||`${l.title}.${l.fileType}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r),u.success("下载成功")}catch{u.error("下载失败")}},fe=async l=>{try{await Xe.confirm(`确定要删除文档"${l.title}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await V.delete(l.id),u.success("文档删除成功"),w()}catch(e){e!=="cancel"&&u.error("文档删除失败")}},ve=l=>({txt:"info",docx:"primary",doc:"warning",pdf:"danger"})[l]||"info",A=l=>{if(l===0)return"0 B";const e=1024,r=["B","KB","MB","GB"],i=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,i)).toFixed(2))+" "+r[i]},H=l=>new Date(l).toLocaleString("zh-CN"),ge=l=>{if(l==="暂无内容")return l;try{return Ze(l)}catch(e){return console.error("Markdown渲染失败:",e),l}};return Ve(()=>{w()}),(l,e)=>{const r=Be,i=Te,D=De,_=Ge,I=$e,_e=Me,ye=Fe,k=Pe,we=qe,J=Oe,N=Le,he=Qe,xe=We,ke=Ee;return y(),W("div",et,[n("div",tt,[n("h1",lt,[t(r,{class:"title-icon"},{default:a(()=>[t(c(F))]),_:1}),e[14]||(e[14]=d(" 文档管理 ",-1))]),e[15]||(e[15]=n("p",{class:"page-subtitle"}," 管理系统中的文档文件，支持上传、查看、编辑和删除 ",-1))]),n("div",at,[n("div",ot,[t(i,{type:"primary",onClick:e[0]||(e[0]=o=>T.value=!0)},{default:a(()=>[t(r,null,{default:a(()=>[t(c(Se))]),_:1}),e[16]||(e[16]=d(" 上传文档 ",-1))]),_:1})]),n("div",nt,[t(D,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=o=>L.value=o),placeholder:"搜索文档标题或内容",style:{width:"300px"},clearable:"",onKeyup:ze(q,["enter"])},{append:a(()=>[t(i,{onClick:q},{default:a(()=>[t(r,null,{default:a(()=>[t(c(Re))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),n("div",st,[Ue((y(),C(_e,{data:K.value,style:{width:"100%"},stripe:""},{default:a(()=>[t(_,{prop:"title",label:"文档标题","min-width":"200"},{default:a(({row:o})=>[n("div",it,[t(r,{class:"file-icon"},{default:a(()=>[o.fileType==="docx"||o.fileType==="doc"?(y(),C(c(F),{key:0})):o.fileType==="pdf"?(y(),C(c(F),{key:1})):(y(),C(c(F),{key:2}))]),_:2},1024),n("span",null,g(o.title),1)])]),_:1}),t(_,{prop:"filename",label:"文件名","min-width":"150"}),t(_,{prop:"fileType",label:"文件类型",width:"100"},{default:a(({row:o})=>[t(I,{type:ve(o.fileType)},{default:a(()=>[d(g(o.fileType.toUpperCase()),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"fileSize",label:"文件大小",width:"120"},{default:a(({row:o})=>[d(g(A(o.fileSize)),1)]),_:1}),t(_,{prop:"userName",label:"上传者",width:"120"}),t(_,{prop:"isGraphBuilt",label:"图谱状态",width:"120"},{default:a(({row:o})=>[o.isGraphBuilt===1?(y(),C(I,{key:0,type:"success"},{default:a(()=>[t(r,null,{default:a(()=>[t(c(Ie))]),_:1}),e[17]||(e[17]=d(" 已构建 ",-1))]),_:1})):(y(),C(I,{key:1,type:"info"},{default:a(()=>[...e[18]||(e[18]=[d("未构建",-1)])]),_:1}))]),_:1}),t(_,{prop:"createTime",label:"上传时间",width:"180"},{default:a(({row:o})=>[d(g(H(o.createTime)),1)]),_:1}),t(_,{label:"操作",width:"320",fixed:"right"},{default:a(({row:o})=>[t(i,{size:"small",onClick:j=>re(o)},{default:a(()=>[t(r,null,{default:a(()=>[t(c(Ne))]),_:1}),e[19]||(e[19]=d(" 查看 ",-1))]),_:1},8,["onClick"]),t(i,{size:"small",type:"success",onClick:j=>ce(o)},{default:a(()=>[t(r,null,{default:a(()=>[t(c(je))]),_:1}),e[20]||(e[20]=d(" 下载 ",-1))]),_:1},8,["onClick"]),t(i,{size:"small",type:"primary",onClick:j=>ue(o)},{default:a(()=>[t(r,null,{default:a(()=>[t(c(X))]),_:1}),e[21]||(e[21]=d(" 编辑 ",-1))]),_:1},8,["onClick"]),t(i,{size:"small",type:"danger",onClick:j=>fe(o)},{default:a(()=>[t(r,null,{default:a(()=>[t(c(Ke))]),_:1}),e[22]||(e[22]=d(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ke,B.value]]),n("div",rt,[t(ye,{"current-page":h.value,"onUpdate:currentPage":e[2]||(e[2]=o=>h.value=o),"page-size":U.value,"onUpdate:pageSize":e[3]||(e[3]=o=>U.value=o),"page-sizes":[10,20,50,100],total:O.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ee,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),t(N,{modelValue:T.value,"onUpdate:modelValue":e[6]||(e[6]=o=>T.value=o),title:"上传文档",width:"500px","close-on-click-modal":!1},{footer:a(()=>[n("span",ut,[t(i,{onClick:e[5]||(e[5]=o=>T.value=!1)},{default:a(()=>[...e[25]||(e[25]=[d("取消",-1)])]),_:1}),t(i,{type:"primary",loading:S.value,onClick:se},{default:a(()=>[...e[26]||(e[26]=[d(" 上传 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(J,{ref_key:"uploadFormRef",ref:$,model:f,rules:Y,"label-width":"80px"},{default:a(()=>[t(k,{label:"文档标题",prop:"title"},{default:a(()=>[t(D,{modelValue:f.title,"onUpdate:modelValue":e[4]||(e[4]=o=>f.title=o),placeholder:"请输入文档标题"},null,8,["modelValue"])]),_:1}),t(k,{label:"选择文件",prop:"file"},{default:a(()=>[t(we,{ref_key:"uploadRef",ref:z,"auto-upload":!1,"on-change":le,"on-remove":ae,"before-upload":ne,accept:".txt,.docx,.doc,.pdf",limit:1,"file-list":E.value,"on-exceed":oe,drag:""},{tip:a(()=>[...e[23]||(e[23]=[n("div",{class:"el-upload__tip"}," 支持 txt、docx、doc、pdf 格式，文件大小不超过 50MB ",-1)])]),default:a(()=>[t(r,{class:"el-icon--upload"},{default:a(()=>[t(c(Ae))]),_:1}),e[24]||(e[24]=n("div",{class:"el-upload__text"},[d(" 将文件拖到此处，或"),n("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(N,{modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=o=>M.value=o),title:"文档详情",width:"900px","close-on-click-modal":!1},{default:a(()=>[m.value?(y(),W("div",dt,[n("div",pt,[n("h3",null,g(m.value.title),1),n("div",mt,[n("span",null,"文件名："+g(m.value.filename),1),n("span",null,"文件类型："+g(m.value.fileType.toUpperCase()),1),n("span",null,"文件大小："+g(A(m.value.fileSize)),1),n("span",null,"上传者："+g(m.value.userName),1),n("span",null,"上传时间："+g(H(m.value.createTime)),1)])]),n("div",ct,[n("div",ft,[e[27]||(e[27]=n("h4",null,"文档摘要",-1)),n("p",vt,g(m.value.summary||"暂无摘要"),1)]),n("div",gt,[e[28]||(e[28]=n("h4",null,"文档内容",-1)),n("div",_t,[n("div",{innerHTML:ge(m.value.content||"暂无内容")},null,8,yt)])])]),n("div",wt,[t(i,{type:"primary",onClick:de},{default:a(()=>[t(r,null,{default:a(()=>[t(c(X))]),_:1}),e[29]||(e[29]=d(" 编辑文档 ",-1))]),_:1})])])):He("",!0)]),_:1},8,["modelValue"]),t(N,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=o=>x.value=o),title:"编辑文档",width:"1400px","close-on-click-modal":!1},{footer:a(()=>[n("span",xt,[t(i,{onClick:e[12]||(e[12]=o=>x.value=!1)},{default:a(()=>[...e[31]||(e[31]=[d("取消",-1)])]),_:1}),t(i,{type:"primary",loading:R.value,onClick:pe},{default:a(()=>[...e[32]||(e[32]=[d(" 保存 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(J,{ref_key:"editFormRef",ref:P,model:s,rules:Z,"label-width":"100px"},{default:a(()=>[t(k,{label:"文档标题",prop:"title"},{default:a(()=>[t(D,{modelValue:s.title,"onUpdate:modelValue":e[8]||(e[8]=o=>s.title=o),placeholder:"请输入文档标题"},null,8,["modelValue"])]),_:1}),t(k,{label:"文档摘要",prop:"summary"},{default:a(()=>[n("div",ht,[t(D,{modelValue:s.summary,"onUpdate:modelValue":e[9]||(e[9]=o=>s.summary=o),type:"textarea",rows:3,placeholder:"请输入文档摘要",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),t(i,{type:"success",size:"small",loading:G.value,onClick:me,class:"ai-action-btn-corner"},{default:a(()=>[t(r,null,{default:a(()=>[t(c(Je))]),_:1}),e[30]||(e[30]=d(" AI生成摘要 ",-1))]),_:1},8,["loading"])])]),_:1}),t(k,{label:"文档内容",prop:"content"},{default:a(()=>[t(D,{modelValue:s.content,"onUpdate:modelValue":e[10]||(e[10]=o=>s.content=o),type:"textarea",rows:20,placeholder:"请输入文档内容",maxlength:"10000","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(k,{label:"图谱状态"},{default:a(()=>[t(he,{modelValue:s.isGraphBuilt,"onUpdate:modelValue":e[11]||(e[11]=o=>s.isGraphBuilt=o),"active-value":1,"inactive-value":0,"active-text":"已构建","inactive-text":"未构建","active-color":"#13ce66","inactive-color":"#909399"},null,8,["modelValue"]),t(xe,{title:"提示：修改图谱状态可能导致增量构建逻辑不一致，请谨慎操作",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"10px"}})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),jt=be(kt,[["__scopeId","data-v-96fdc505"]]);export{jt as default};
